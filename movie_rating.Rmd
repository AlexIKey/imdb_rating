---
title: "IMDB датасет"
output: html_notebook
---

Скоріш за все, якщо ми поставимо за мету, знайти людину, яка б не любила кіно, то зазнаємо поразки. Кіно, так чи інакше, люблять всі. Хтось фантастику чи драму, хтось фільми жахів чи детективи, можливо, документальне чи науково-популярне, але загалом кіно займає значну долю нашого культурного життя.

В інтернеті можна знайти так звані сайти-рейтинги для художніх фільмів (а також мультфільмів, серіалів, документальних стріок тощо), самий популярний та відомий з яких [IMDB](http://imdb.com).

Із менш популярних можна назвати:
[Rotten Tomatoes](http://www.rottentomatoes.com/)
[Movies.com](http://www.movies.com/)
[Movies.yahoo](https://www.yahoo.com/movies/)
[Allmovie](http://www.allmovie.com/)
[КиноПоиск](https://www.kinopoisk.ru/)

На такого роду сайтах ми можемо знайти багато цікавої інформації про фільм, починаючи від короткого змісту сюжету до фінансового успіху стрічки. Але якщо ми візьмемо дані про сотні чи навіть тисячі фільмів, чи зможемо ми виявити та узагальнити основні тенденціі кіноіндустрії? Давайте спробуємо.


Перш за все нам будуть потрібні дані, з якими ми будемо працювати. На жаль, сайт [IMDB](http://imdb.com) не дає змоги отримати дані про всі фільми у вигляді якої-небудь таблиці, з якою вже було б зручно працювати. Тому дослідники вимушені використовувати різні програмні трюки, щоб зібрати дані та переформатувати їх у зручний для аналізу вигляд.

На щастя, я не перший, кого зацікавило дане питання, тому я можу використати готовий до вжитку, найбільш популярний щодо кіноіндустрії датасет [IMDB 5000 Movie Dataset](https://www.kaggle.com/deepmatrix/imdb-5000-movie-dataset), остання версія якого датується 14 серпня 2016 року. Тобто останні фільми за півроку туда не війдуть, але на загальні тенденції це практично не вплине.

Отже, почнемо.
 * Clear memory
```{r}
# a) Load libraries
#Setup
rm(list = ls(all = TRUE)) 
gc(reset=TRUE)
set.seed(1234) #From random.org

```

```{r}
#load libraries
library(dplyr)
library(tidyr)
library(ggplot2) # visualization
library(ggthemes) # visualization
library(scales) # visualization
library(data.table)
library(stringr)

```
```{r}
#----------------------------------------
# GENERAL THEME
# - we'll use this for most of our charts
#   and build on it when we need to
#----------------------------------------

theme.porttheme <-  
  theme(text = element_text(family = "Gill Sans", color = "#444444")) +
  theme(plot.title = element_text(size = 24)) +
  #theme(plot.subtitle = element_text(size = 18)) +
  theme(axis.title = element_text(size = 14)) +
  theme(axis.title.y = element_text(angle = 0, vjust = .5, margin = margin(r = 15))) +
  theme(axis.text = element_text(size = 10)) +
  theme(axis.title.x = element_text(margin = margin(t = 20))) +
  theme(legend.title = element_blank()) 
  


#------------------------------------
# THEME FOR 'WIDE' BAR CHARTS
# - there are several bar charts that 
#   are very wide, and need some
#   special formatting
#------------------------------------

theme.widebar <-
  theme.porttheme +
  theme(plot.title = element_text(size = 30)) +
  #theme(plot.subtitle = element_text(size = 20)) +
  theme(legend.title = element_blank(), legend.background = element_blank()) +
  theme(legend.text = element_text(size = 12)) +
  theme(legend.position = c(.9,.55)) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = .4))
  


#------------------------------------
# THEME FOR 'WIDE' BAR CHARTS
#  - we'll use this for small multiple 
#    charts.  these also have some
#    special formatting requirements
#------------------------------------

theme.smallmult <- 
  theme.porttheme +
  theme(axis.text = element_text(size = 6)) +
  theme(axis.text.x = element_text(angle = 90))
```

Прочитаємо датасет та подивимось на його структуру
```{r}
movies = read.csv("movie_metadata.csv",stringsAsFactors = F,encoding = "UTF-8")
str(movies)


```

Унікальний ключ для одного запису (рядка в таблиці) - це поле "movie_imdb_link", тобто посилання на фільм на сайті IMDB. Подивимось чи дублються записи: 
```{r}
sum(duplicated(movies$movie_imdb_link))
#http://www.imdb.com/title/tt0092337/?ref_=fn_tt_tt_1

```

Так,є 124 дублікатів, приберемо їх.

```{r}
uni_movies <- subset(movies, !duplicated(movies$movie_imdb_link))
sum(duplicated(uni_movies$movie_imdb_link))

```

Подивимось TOP20 фільмів за оцінкою. При цьому використаємо оцінку, за яку проголосувало більше 1000 осіб.

```{r}
temp <- uni_movies %>% subset(uni_movies$num_voted_users>1000) %>%  select(movie_title,imdb_score)%>% arrange(desc(imdb_score))
temp <- temp[1:20,]

# Add title, narrower bars, fill color, and change axis labels
#Bar Chart with 2 variables
ggplot(temp, aes(x = reorder(movie_title,imdb_score), 
    y = imdb_score, fill = imdb_score)) +
  geom_bar(stat='identity') + 
  geom_text(aes(x = movie_title, y = 0.5, label=imdb_score),
    hjust=0, vjust=0.55, size = 4, colour = 'red') +
  labs(x = 'movie_title') +
  coord_flip() + 
  theme_few()

```

Глянемо розподіл рейтингів 
```{r}
ggplot(uni_movies, aes(x=imdb_score)) +
    geom_histogram(binwidth=0.2, colour="black", fill="white") +
    geom_vline(aes(xintercept=mean(imdb_score, na.rm=T)),   # Ignore NA values for mean
               color="red", linetype="dashed", size=1)
```

Графік кількості від року


```{r}
temp <- uni_movies %>% select(title_year,imdb_score) %>% group_by(title_year) %>% 
  summarise(quantity = length(title_year))

ggplot(temp, aes(title_year,quantity)) +
  geom_line(na.rm = TRUE)

ggplot(temp, aes(title_year,quantity)) +
  geom_smooth(na.rm = TRUE)

```

Графік рейтингу від року
```{r}

temp <- uni_movies %>% select(title_year,imdb_score) %>% group_by(title_year) %>% 
  summarise(mean_rate = mean(imdb_score))

ggplot(temp, aes(title_year, mean_rate)) + 
  geom_line(na.rm = TRUE)

ggplot(temp, aes(title_year, mean_rate)) + 
  geom_smooth(na.rm = TRUE)


```

Рейтинг в залежності від жанру
```{r}

temp <- uni_movies %>% select(genres ,imdb_score)

temp$genres <- substr(temp$genres,1,
                      ifelse(regexpr("[|]",temp$genres)>0,
                             regexpr("[|]",temp$genres)-1,
                             nchar(temp$genres)))


temp <- temp %>% group_by(genres) %>%
  summarise(mean_rate = mean(imdb_score))

ggplot(temp, aes(genres, mean_rate)) + 
  geom_bar(na.rm = TRUE, stat = "identity")

```

